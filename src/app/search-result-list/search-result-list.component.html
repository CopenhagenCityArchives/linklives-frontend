<section class="lls-results-header">
    <div class="lls-container">
        <div class="lls-results-header__link-section">
            <a routerLink="/" class="lls-results-header__link">
                <svg class="lls-icon">
                    <use [attr.href]="featherSpriteUrl + '#arrow-left'"></use>
                </svg>
                Tilbage til forsiden
            </a>
            <a
                (click)="openSearchHistory = true"
                (keyup.enter)="openSearchHistory = true"
                class="lls-results-header__link lls-results-header__history-link"
                tabindex="0"
            >
                Min søgehistorik
            </a>
        </div>
        <app-search-history
            [openSearchHistory]="openSearchHistory"
            [featherIconPath]="config.featherIconPath"
            (close)="closeSearchHistory()"
        ></app-search-history>
        <form (ngSubmit)="search()" class="lls-row">
            <div class="lls-columns-12 lls-columns-6--md lls-columns-8--lg lls-columns-9--xl">
                <div class="lls-row lls-row--align-bottom">
                    <label class="lls-results-header__field-label lls-columns-12 lls-columns-6--md lls-columns-4--lg lls-columns-2--xl" *ngFor="let searchTerm of searchTerms; index as i;">
                        <span class="lls-results-header__field-label-text">{{ searchFieldLabels[searchTerm.field] }}</span>
                        <div class="lls-input-group">
                            <input
                                [(ngModel)]="searchTerm.value"
                                type="text"
                                [placeholder]="searchFieldPlaceholders[searchTerm.field]"
                                class="lls-input-field"
                                [name]="'searchterm-value-' + i"
                            />
                            <button
                                type="button"
                                class="lls-input-group__floating-action"
                                [class]="searchTerms.length < 2 ? 'lls-input-group__floating-action--disabled' : ''"
                                aria-label="Fjern søgning på felt"
                                (click)="removeSearchTerm(i, $event)"
                            >
                                <svg class="lls-icon lls-icon--right">
                                    <use [attr.href]="featherSpriteUrl + '#minus-circle'"></use>
                                </svg>
                            </button>
                        </div>
                    </label>
                    <div class="lls-results-header__field-label lls-results-header__field-label--actions lls-columns-6 lls-columns-6--md lls-columns-4--lg">
                        <lls-dropdown
                            class="lls-dropdown--option-adder"
                            [options]="fieldOptions"
                            name="add-field"
                            label="Tilføj felt"
                            [featherIconPath]="config.featherIconPath"
                            dropdownIcon="plus-circle"
                            dropdownIconOpen="plus-circle"
                            (change)="addField($event)"
                        ></lls-dropdown>
                        <button
                            type="button"
                            class="lls-results-header__clear-search"
                            (click)="clearSearchTerms()"
                        >
                            Nulstil
                            <svg class="lls-icon lls-icon--right">
                                <use [attr.href]="featherSpriteUrl + '#x-circle'"></use>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
            <div class="lls-results-header__field-label lls-columns-12 lls-columns-3--md lls-columns-2--lg lls-columns-2--xl">
                <span class="lls-results-header__field-label-text">Resultattype</span>
                <div class="lls-results-header__checkboxes">
                    <label class="lls-results-header__checkbox-container" *ngFor="let index of indexKeys">
                        <input
                            [(ngModel)]="indices[index].value"
                            type="checkbox"
                            class="lls-results-header__checkbox"
                            [name]="'index_' + index"
                        >
                        <span>{{ indices[index].label }}</span>
                    </label>
                </div>
                <div class="lls-results-header__checkboxes">
                    <label class="lls-results-header__checkbox-container">
                        <input
                            [(ngModel)]="modeFuzzy"
                            type="checkbox"
                            class="lls-results-header__checkbox"
                            name="modeFuzzy"
                        >
                        <span>Inkluder stavevariationer</span>
                    </label>
                </div>
            </div>
            <div class="lls-results-header__right-section lls-columns-12 lls-columns-3--md lls-columns-2--lg lls-columns-1--xl">
                <button
                    type="submit"
                    class="lls-btn lls-btn--medium lls-btn--blue"
                >
                    <span>Søg</span>
                    <svg class="lls-icon lls-icon--right">
                        <use [attr.href]="featherSpriteUrl + '#search'"></use>
                    </svg>
                </button>
            </div>
        </form>
    </div>
</section>
<section class="lls-container">
    <div class="lls-row">
        <div class="lls-columns-12 lls-columns-7--md lls-columns-8--lg lls-search-modifiers">
            <!-- Filtering -->
            <span class="lls-search-modifier-inputs__label">Filter resultater</span>
            <button class="lls-btn lls-btn--outline lls-btn--link" (click)="openSidebar = true">
                <span>Kilder</span>
                <svg class="lls-icon lls-icon--right">
                    <use [attr.href]="featherSpriteUrl + '#chevron-right'"></use>
                </svg>
            </button>
            <lls-filter-sidebar
                [(ngModel)]="sourceFilter"
                [openSidebar]="openSidebar"
                [featherIconPath]="config.featherIconPath"
                [possibleSources]="possibleSources"
                (closeSidebar)="closeSidebar($event)"
                (removeFilter)="removeFilter($event)"
            ></lls-filter-sidebar>
            <div
                *ngIf="sourceFilter.length"
                class="lls-results-filter__items"
            >
                <div
                    *ngFor="let filterItem of sourceFilter; index as i;"
                    class="lls-filter-chip lls-btn lls-btn--grey u-mr-2 u-mt-2 u-text-capitalize"
                >
                    <svg class="lls-icon u-mr-2" [attr.alt]="getEventTypeFromSourceFilterValue(filterItem)">
                        <use [attr.href]="config.featherIconPath + '#' + getIconFromSourceFilterValue(filterItem)"></use>
                    </svg>
                    <span>{{ getYearFromSourceFilterValue(filterItem) }}</span>
                    <button
                        class="lls-filter-chip__remove-filter"
                        tabindex="0"
                        aria-label="Fjern dette filter"
                        (click)="removeFilter(filterItem)"
                    >
                        <svg
                            class="lls-icon lls-icon--white lls-icon--right"
                        >
                            <use [attr.href]="config.featherIconPath + '#x'"></use>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        <div class="lls-columns-12 lls-columns-5--md lls-columns-4--lg lls-search-modifiers lls-search-modifiers--right">
            <div class="lls-search-modifier-inputs lls-search-modifier-inputs">
                <label class="lls-search-modifier-inputs__entry lls-search-modifier-inputs__entry--basis-110">
                    <span class="lls-search-modifier-inputs__label">Antal per side</span>
                    <lls-dropdown
                        class="lls-dropdown--grey"
                        [options]="sizeOptions"
                        [(ngModel)]="pagination.size"
                        [featherIconPath]="featherSpriteUrl"
                        (change)="search()"
                    ></lls-dropdown>
                </label>
                <label class="lls-search-modifier-inputs__entry lls-search-modifier-inputs__entry--basis-200">
                    <span class="lls-search-modifier-inputs__label">Sorter efter</span>
                    <lls-dropdown
                        class="lls-dropdown--grey"
                        [options]="sortByOptions"
                        [(ngModel)]="sortBy"
                        [featherIconPath]="featherSpriteUrl"
                        (change)="search()"
                    ></lls-dropdown>
                </label>
                <label class="lls-search-modifier-inputs__entry lls-search-modifier-inputs__entry--flex-0">
                    <span class="lls-search-modifier-inputs__label">&nbsp;</span>
                    <lls-boolean
                        [(ngModel)]="sortAscending"
                        [featherIconPath]="featherSpriteUrl"
                        iconFalse="arrow-up"
                        iconTrue="arrow-down"
                        (change)="search()"
                    ></lls-boolean>
                </label>
            </div>
            <div class="u-mt-2" [innerHTML]="resultRangeDescription"></div>
        </div>
    </div>
    <div class="lls-row">
        <ng-container *ngFor="let hit of searchResult.hits" [ngSwitch]="hit.type">
            <app-person-appearance-item *ngSwitchCase="'pas'" class="lls-columns-12" [item]="hit.pa"></app-person-appearance-item>
            <app-life-course-item *ngSwitchCase="'lifecourses'" class="lls-columns-12" [item]="hit.pas" [lifecourse-id]="hit.life_course_id"></app-life-course-item>
        </ng-container>
        <div *ngIf="!searchResult.hits.length" class="lls-columns-12 u-text-center">
            <p>
                Din søgning gav ingen resultater.
            </p>
        </div>
    </div>

    <nav aria-label="Navigation mellem sider">
        <div class="lls-pagination">
            <a
                class="lls-pagination__item"
                [ngClass]="{ 'lls-pagination__item--disabled': pagination.current === 1}" 
                [tabindex]=" pagination.current === 1 ? -1 : 0"
                aria-label="gå til forrige side"
                [routerLink]="['./', { 'size': pagination.size, 'page': pagination.current - 1 } ]"
                [queryParams]="queryParams"
            >
                <svg class="lls-icon">
                    <use [attr.href]="featherSpriteUrl + '#arrow-left'"></use>
                </svg>
            </a>

            <ng-container *ngIf="pagination.firstInOrder > 1">
                <a
                    class="lls-pagination__item"
                    aria-label="gå til første side"
                    [routerLink]="['./', { 'size': pagination.size, 'page': 1 } ]"
                    [queryParams]="queryParams"
                >
                    <span class="lls-pagination__item-text">1</span>
                </a>
                <div
                    class="lls-pagination__entry"
                    *ngIf="pagination.firstInOrder > 2"
                >
                    &mdash;
                </div>
            </ng-container>
            
            <a class="lls-pagination__item"
                *ngFor="let page of pagination.navigationPages"
                [ngClass]="{ 'lls-pagination__item--selected': pagination.current === page }"
                [routerLink]="['./', { 'size': pagination.size, 'page': page } ]"
                [queryParams]="queryParams"
            >
                <span class="lls-pagination__item-text">
                    {{ prettyPaginationNumber(page) }}
                </span>
            </a>

            <ng-container *ngIf="pagination.lastInOrder < pagination.last">
                <div
                    class="lls-pagination__entry"
                    *ngIf="pagination.lastInOrder < pagination.last - 1"
                >
                    &mdash;
                </div>
                <a
                    class="lls-pagination__item"
                    [routerLink]="['./', { 'size': pagination.size, 'page': pagination.last } ]"
                    [queryParams]="queryParams"
                >
                    <span class="lls-pagination__item-text">
                        {{ prettyPaginationNumber(pagination.last) }}
                    </span>
                </a>
            </ng-container>

            <a
                class="lls-pagination__item"
                [ngClass]="{ 'lls-pagination__item--disabled': pagination.current >= pagination.last }"
                aria-label="gå til næste side"
                [tabindex]="pagination.current >= pagination.last ? -1 : 0"
                [routerLink]="['./', { 'size': pagination.size, 'page': pagination.current + 1 } ]"
                [queryParams]="queryParams"
            >
                <svg class="lls-icon">
                    <use [attr.href]="featherSpriteUrl + '#arrow-right'"></use>
                </svg>
            </a>
        </div>
    </nav>
</section>
