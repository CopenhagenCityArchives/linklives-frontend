<div class="lls-container mt-5">
    <section class="lls-data-page-header u-mb-4">
        <div class="lls-data-page-header__classification">
            <h2 class="lls-data-page-header__source-type">Livsforløb</h2>
            <h1 class="lls-data-page-header__title u-text-capitalize">{{ latestPersonAppearance.name_clean }}</h1>
            <div class="lls-data-page-header__data-summary">
                <p class="u-text-capitalize u-mr-2">
                    <span class="u-text-grey--light u-mr-2">Fødested</span> {{ birthLocation }}
                </p>
                <p class="u-align-icon">
                    <svg class="lls-icon lls-icon--filled lls-icon--small lls-icon--left">
                        <use [attr.href]="featherSpriteUrl + '#star'"></use>
                    </svg>
                    ca. {{ latestPersonAppearance.source_year - latestPersonAppearance.age_clean }}
                </p>
            </div>
        </div>
        <div class="lls-data-page-header__utility-links">
            <a
                class="u-mr-2"
                tabindex="0"
                onclick="window.history.back()"
                style="cursor: pointer;"
            >
                Tilbage til søgning
            </a>
            <a
                (click)="openSearchHistory = true"
                (keyup.enter)="openSearchHistory = true"
                tabindex="0"
                style="cursor: pointer;"
            >
                Min søgehistorik
            </a>
        </div>
    </section>
    <app-search-history
        [openSearchHistory]="openSearchHistory"
        [featherIconPath]="featherSpriteUrl"
        (close)="openSearchHistory = false"
    ></app-search-history>
    <div class="lls-life-course-source-container">
        <section class="lls-life-course-source-container__source-list">
            <h3 class="u-margin-0">Kilder</h3>
            <app-person-appearance-item [item]="pa" class="mx-2" *ngFor="let pa of pas"></app-person-appearance-item>
        </section>
        <section class="lls-life-course-source-container__source-linking-graph">
            <svg width="200px" [attr.height]="(196 + 16) * pas.length" [attr.viewBox]="'0 0 200 ' + ((196 + 16) * pas.length)">
                <style scoped>
                    .lls-life-course-source-container__source-linking-graph-source-year {
                        font-size: 0.9rem;
                        font-weight: 600;
                        letter-spacing: 1px;
                    }
                    .lls-life-course-source-container__source-linking-graph-tooltip {
                        font-size: 0.8rem;
                        opacity: 0;
                        transition: opacity 0.4s;
                        fill: white;
                    }
                    .lls-life-course-source-container__source-linking-graph-tooltip > * {
                        pointer-events: none;
                    }
                    .lls-life-course-source-container__source-linking-graph-link:hover .lls-life-course-source-container__source-linking-graph-tooltip > * {
                        pointer-events: all;
                    }
                    .lls-life-course-source-container__source-linking-graph-link:hover .lls-life-course-source-container__source-linking-graph-tooltip {
                        opacity: 1;
                    }
                    .lls-life-course-source-container__source-linking-graph-tooltip-box, .lls-life-course-source-container__source-linking-graph-tooltip-box-tip {
                        fill: rgb(6, 40, 81);
                    }
                    .lls-life-course-source-container__source-linking-graph-link-background {
                        stroke: rgb(224, 224, 224);
                        stroke-width: 0;
                        transition: stroke-width 0.4s;
                    }
                    .lls-life-course-source-container__source-linking-graph-link:hover .lls-life-course-source-container__source-linking-graph-link-background {
                        stroke-width: 4px;
                    }

                    .lls-life-course-source-container__source-linking-graph-link-path {
                        stroke: #767676;
                        stroke-dasharray: 3, 1;
                        transition: 0.4s;
                    }
                    .lls-life-course-source-container__source-linking-graph-link:hover .lls-life-course-source-container__source-linking-graph-link-path {
                        stroke: rgb(25, 85, 163);
                        stroke-dasharray: 3, 0;
                        stroke-width: 2px;
                    }
                </style>
                <!-- Cirlces for years -->
                <g
                    *ngFor="let pa of pas; index as i;"
                    [attr.transform]="'translate(0 ' + ((196 + 27) * i + (196 / 2)) + ')'"
                >
                    <text
                        class="lls-life-course-source-container__source-linking-graph-source-year"
                        text-anchor="end"
                        alignment-baseline="middle"
                        x="40"
                        dy=".3em"
                    >
                        {{ pa.source_year }}
                    </text>
                    <circle
                        cx="65"
                        r="17"
                        fill="rgb(224, 224, 224)"
                    />
                    <circle
                        cx="65"
                        r="5"
                        fill="rgb(203, 150, 74)"
                        stroke="white"
                        stroke-width="2"
                    />
                </g>
                <!-- Chronological lines between -->
                <line
                    x1="65"
                    x2="65"
                    [attr.y1]="((196 + 27) * i + (196 / 2)) + 20 + 5"
                    [attr.y2]="((196 + 27) * (i + 1) + (196 / 2)) - 20 - 5"
                    stroke="black"
                    *ngFor="let pa of pas.slice(1); index as i; let last = last;"
                />
                <!-- Links -->
                <g
                    *ngFor="let link of drawableLinks; index as i;"
                    [attr.transform]="'translate(90 ' + link.offsetY + ')'"
                    class="lls-life-course-source-container__source-linking-graph-link"
                >
                    <circle
                        class="lls-life-course-source-container__source-linking-graph-link-background"
                        [attr.cx]="link.pathTierX"
                        [attr.cy]="(196 + 27) / 2"
                        r="10"
                        fill="rgb(224, 224, 224)"
                    />
                    <path
                        class="lls-life-course-source-container__source-linking-graph-link-path"
                        [attr.d]="link.path"
                        fill="transparent"
                    />
                    <circle
                        [attr.cx]="link.pathTierX"
                        [attr.cy]="(196 + 27) / 2"
                        r="4"
                        stroke="white"
                        stroke-width="5"
                        stroke-alignment="outer"
                        fill="black"
                    />
                    <g
                        class="lls-life-course-source-container__source-linking-graph-tooltip"
                        [attr.transform]="'translate(' + (link.pathTierX - 60) + ' ' + ((196 + 27) / 2 - 105) + ')'"
                    >
                        <rect
                            class="lls-life-course-source-container__source-linking-graph-tooltip-box"
                            x="0"
                            width="120"
                            y="0"
                            height="100"
                            rx="3"
                        />
                        <path
                            class="lls-life-course-source-container__source-linking-graph-tooltip-box-tip"
                            d="M53,98 l7,7 l7,-7 h-14"
                        />
                        <text
                            text-anchor="middle"
                            class="lls-life-course-source-container__source-linking-graph-tooltip-label"
                            x="60"
                            y="20"
                            dy=".3em"
                            fill="rgb(224, 224, 224)"
                        >
                            Sikkerhed
                        </text>
                        <text
                            text-anchor="middle"
                            class="lls-life-course-source-container__source-linking-graph-tooltip-confidence"
                            x="60"
                            y="42"
                            dy=".3em"
                            fill="white"
                            font-size="2rem"
                            font-weight="bold"
                        >
                            {{ link.confidencePct }}%
                        </text>
                        <text
                            class="lls-life-course-source-container__source-linking-graph-tooltip-description"
                            font-weight="bold"
                            x="60"
                            y="72"
                            text-anchor="middle"
                        >
                            Linket via
                        </text>
                        <text
                            class="lls-life-course-source-container__source-linking-graph-tooltip-description"
                            font-weight="bold"
                            x="60"
                            y="85"
                            text-anchor="middle"
                        >
                            {{ link.linkingMethod }}
                        </text>
                    </g>
                </g>
            </svg>
        </section>
    </div>
    <section>
        <div class="lls-data-page-footer">
            <div class="lls-data-page-footer__entry">
                <div class="lls-data-page-footer__entry-label">
                    Forløbs ID
                </div>
                <a [href]="'life-course/' + lifecourseId">{{ lifecourseId }}</a>
            </div>
            <div class="lls-data-page-footer__entry">
                <div class="lls-data-page-footer__entry-label">
                    Senest opdateret
                </div>
                <p>{{ lastUpdated }}</p>
            </div>
        </div>
        <div class="lls-data-page-footer">
            <div class="lls-data-page-footer__entry">
                <h3 class="lls-data-page-footer__entry-label">
                    Om livsforløb
                </h3>
                <p>
                    Et Livsforløb er et kvalificeret forslag til hvilke historiske kilder, der handler om den samme person. Der kommer løbende flere livsforløb i søgningen og der kan komme flere detaljer på et livsforløb.
                </p>
                <p>
                    Livsforløb består af en række personoplysninger fra kilder som folketællinger og kirkebøger, der er blevet standardiseret for at kunne blive sammenlignet og forbundet digitalt.
                </p>
            </div>
        </div>
    </section>
</div>
